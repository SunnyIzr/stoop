<div class="container">
  <div class="row">
    <div class="col-sm-4 col-sm-push-8">
      <%= render partial: 'layouts/nav' %>
      <div class="col-sm-12 side-bar-margin">

        <div class="row side-bar-chat">

          <div class="col-xs-12">
            <input type="text" class="search-field empty" id="iconified" placeholder="&#xF002; " style="font-family:Arial, FontAwesome; font-size:20px;">
          </div>
          <% @current_user.mailbox.conversations.limit(10).each do |conversation| %>
          <% recipient = (conversation.participants - [current_user]).first %>
            <a href='<%= conversation_path(conversation) %>'>
              <div class="col-xs-12 <%= "recent-chat-active" if @conversation == conversation %>">
                <div class="row">
                  <div class="col-xs-4">
                    <img class="img-responsive" src="<%= recipient.avatar %>" alt="<%= recipient.first_name %>">
                  </div>
                  <div class="col-xs-8">
                    <h4 class="chat-name"><%= recipient.name %></h4>
                    <span class="chat"><%= conversation.messages.last.body.truncate(60) %></span>
                  </div>
                </div>
              </div>
            </a>
          <% end %>
        </div>

      </div>
    </div>
    <div class="col-sm-8 col-sm-pull-4">
      <div class="col-xs-12 msg-top">
        <div class="col-sm-3 new-msg">+ New Message</div>
        <div class="col-sm-8 msg-bg"><input type="text" class="msg-search-field empty" id="iconified" placeholder="&#xF002; " style="font-family:Arial, FontAwesome; font-size:20px;"></div>
        <div class="col-sm-1 setting"><img class="settings" src="<%= asset_path 'settings.png' %>" alt="Settings"></div>
      </div>
      <div style="text-align:left; color:#fff;" class="col-xs-12 building-neighborhood-bar">
        
        Message with <%= @recipient.name %>
        <!--NOTE: I recommend toggling the class "active" on/off with jquery-->
      </div>
    </div>
    <div class='conversation-messages'>
      <% @conversation.messages.reverse.each do |message| %>
      <% sent_msg = current_user == message.sender %>
        <div class="col-sm-8 col-sm-pull-4 <%= sent_msg ? 'user' : 'recipient' %>">
          <div class='<%= sent_msg ? "inbox-area" : "inbox-person" %>'>
            
            <div class="col-sm-2 col-xs-3">
              <img class="img-responsive" src="<%= message.sender.avatar %>" alt="">
            </div>
            
            <div class="col-sm-10 col-xs-9">
              <h3 class="name"><%= message.sender.name %></h3>
              <p class="time">4 min ago</p>
              <p><%= message.body %></p> 
            </div>
            
          </div>
        </div>
      <% end %>
      <div class="col-sm-8 col-sm-pull-4">
        <%= form_tag reply_conversation_path(@conversation), method: :post do %>
          <%= text_area_tag 'body', nil, cols: 3, class: 'msg-text-area', placeholder: 'Write a reply', required: true %>
          <div class="msg-control-bar">
            <i class="fa fa-camera"></i>
            <i class="fa fa-map-marker"></i>
            <i class="fa fa-paperclip"></i>
            <%= submit_tag "Send", class: 'post' %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>

<div class="container after-profile">
  <div class="row">
    
    
  </div>
</div>

